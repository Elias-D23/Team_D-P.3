@model List<sistemaDeCitasMedicas.Models.Medico>

@{
    ViewData["Title"] = "Buscar Citas";
}

<div class="container mt-4">
    <h2 class="mb-3">Buscar Citas</h2>

    <!-- Formulario de filtro -->
    <form method="get" class="form-inline">
        <label for="especialidadFiltro">Especialidad:</label>
        <select name="especialidad" id="especialidadFiltro">
            <option value="">Seleccione una especialidad</option>
            @foreach (var item in ViewBag.Especialidades)
            {
                <option value="@item">@item</option>
            }
        </select>

        <label for="horarioFiltro">Tanda:</label>
        <select name="tanda" id="horarioFiltro">
            <option value="">Seleccione una tanda</option>
            @foreach (var item in ViewBag.Tandas)
            {
                <option value="@item">@item</option>
            }
        </select>

        <button type="submit">Buscar</button>
    </form>

    <!-- Tabla de médicos -->
    <table class="table mt-3">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Especialidad</th>
                <th>Descripción</th>
                <th>Tandas Disponibles</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var medico in Model)
            {
                <tr class="medico-row" data-especialidad="@medico.Especialidad" data-horario="@string.Join(", ", medico.MedicoDisponibilidades.Select(md => md.Disponibilidad.Tanda))">
                    <td>@medico.Nombre</td>
                    <td>@medico.Especialidad</td>
                    <td>@medico.Descripcion</td>
                    <td>
                        @foreach (var disponibilidad in medico.MedicoDisponibilidades)
                        {
                            <p>@disponibilidad.Disponibilidad.Tanda: @disponibilidad.Disponibilidad.DiaSemana</p>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Filtrar según especialidad y tanda
            $("#especialidadFiltro, #horarioFiltro").on("change", function () {
                var filtroEspecialidad = $("#especialidadFiltro").val().toLowerCase();
                var filtroHorario = $("#horarioFiltro").val().toLowerCase();

                $(".medico-row").each(function () {
                    var especialidad = $(this).data("especialidad").toLowerCase();
                    var horarios = $(this).data("horario").toLowerCase();

                    // Mostrar fila si cumple con los filtros seleccionados
                    if ((filtroEspecialidad === "" || especialidad.includes(filtroEspecialidad)) &&
                        (filtroHorario === "" || horarios.includes(filtroHorario))) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });
        });
    </script>
}
